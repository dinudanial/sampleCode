<?php

class admin_Model_TutorilDao extends Zend_Db_Table_Abstract {

    protected $_name = 'Tutorials';
    protected $_primary = 'ID_Tutorials';

    public function getAllTutorils() {
        try {
       
            $select = $this->select();
           
            $stmt = $select->query();
            $rows = $stmt->fetchAll();
       
            if (count($rows) > 0)
                return $rows;
            else
                return false;
        } catch (Zend_Db_Table_Exception $e) {
            throw new Exception($e->getMessage());
        }
    }
    
    public function getTutorils($gruopId) {
        try {
            $select = $this->select();
            $select->where('d__IsActive = ?', 1)
                   ->where('ID_TutorialsGroup = ?', $gruopId);
            $stmt = $select->query();
            $rows = $stmt->fetchAll();
            if (count($rows) > 0)
                return $rows;
            else
                return false;
        } catch (Zend_Db_Table_Exception $e) {
            throw new Exception($e->getMessage());
        }
    }

    public function save(array $tutorialDtil) {
        try {
           
            $result = $this->insert($tutorialDtil);
            return (integer) $result;
        } catch (Zend_Db_Table_Exception $ex) {
            throw new Exception($ex->getMessage());
        }
    }

    public function edit(array $tutorialDtil) {
        try {
            $data=$tutorialDtil;
            $where['ID_Tutorials=?']=$tutorialDtil['ID_Tutorials'];
            $result=$this->update($data,$where);
            
            return (integer) $result;
        } catch (Zend_Db_Table_Exception $ex) {
            throw new Exception($ex->getMessage());
        }
    }
    
     public function changeStatus($tutorialId, $status) {
        try {
            $data['d__IsActive'] = $status;
            $where['ID_Tutorials = ?'] = $tutorialId;
            $result = $this->update($data, $where);
            return (integer) $result;
        } catch (Zend_Db_Table_Exception $ex) {
            throw new Exception($ex->getMessage());
        }
    }
    
    public function findTutorial($tutorialId)
    {
        try {
            $select = $this->select();
            $select->where('ID_Tutorials = ?', $tutorialId);
            $stmt = $select->query();
            $rows = $stmt->fetch();
           
            if (count($rows) > 0)
                return $rows;
            else
                return false;
            
        } catch (Zend_Db_Table_Exception $exc) {
            echo $exc->getMessage();
        }
            
    }
    
    //Delete Tutorial
    
    public function deleteTutorial($idTutorial)
    {
         try {
                $where['ID_Tutorials=?']=$idTutorial;
                $this->delete($where);
                
            } catch (Zend_Db_Table_Exception $exc) {
                echo $exc->getMessage();
            }
    }
    
    public function getFilesUploaded($idTutorial)
    {
        try {
             $select=  $this->select()
                       // ->from($this,array('d__Html','d__Pdf'))
                         ->from($this,array('d__Pdf','d__Html'))
                        ->where('ID_Tutorials=?',$idTutorial);
             $stmt = $select->query();
             $row = $stmt->fetch();
           
             if($row)
                 return $row;
             else
                 return false;
            
        } catch (Exception $exc) {
            echo $exc->getTraceAsString();
        }
        }

}

?>
