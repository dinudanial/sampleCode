    <?php

class admin_BuslinesController extends Zend_Controller_Action
{

    public function init()
    {
        /* Initialize action controller here */
    }

    public function indexAction()
    {
       $form=new admin_Form_NewBusline();
       $this->view->form=$form;
       
       $busline=new admin_Model_Busline();
       $buslines=$busline->listBuslines();
       $arr = array('buslines'=> $buslines);
       $this->view->assign($arr);
       
       $status=$this->getRequest()->getParam('status');
      
       if($status=="Fail")
       {
           $st=array('status'=>"Please Provide Valid Data");
           $this->view->assign($st);
       }
    }

    public function savebuslineAction()
    {
         $this->_helper->viewRenderer->setNoRender(true);

          if ($this->_request->isPost()) {
               $formData = $this->_request->getPost();
             
                   if($formData['hiddenid']=="")
                   {
                     
                      
                        $busline=new admin_Model_Busline();
                        $busline->setlineName($formData['lineName']);
                        $busline->setinsuranceClass($formData['insuranceclass']);
                        $busline->setenabled($formData['enabled']);
                        $busline->saveBuslines($busline);
                        $this->_redirect("/admin/Buslines");
                   }
                   else
                   {
                     
                        $busline=new admin_Model_Busline();
                        $busline->setlineName($formData['lineName']);
                        $busline->setinsuranceClass($formData['insuranceclass']);
                        $busline->setenabled($formData['enabled']);
                        $busline->setId((integer)$formData['hiddenid']);
                        $busline->editBusline($busline);
                        $this->_redirect("/admin/Buslines");
                   }
              
               
          }
         
    }
    
    public function sortbyinsuranceAction()
    {
         $this->_helper->viewRenderer->setNoRender(true);
          if ($this->_request->isPost()) {
                $insuranceId=$this->getRequest()->getPost('insuranceId');
                $busline=new admin_Model_Busline();
                $details=$busline->searchByInsurance((integer)$insuranceId);
             
                $buslines=array();
                if($details)
                {
                  foreach ($details as $icDetails)
                  {
                    
                    $json=  admin_Model_Busline::getJsonSearch($icDetails);
                    array_push($buslines, $json);
                   }
                }
       
               echo Zend_Json::encode($buslines);exit;
               
                
          }
    }


    public function buslineenableAction(){
        $this->_helper->viewRenderer->setNoRender(true);
        echo "Inside Enable";
    }
    
    public function getbuslinedetailsAction(){
        
        //$this->_helper->viewRenderer->setNoRender(true);
          if ($this->_request->isPost()) {
            $BuslineId=$this->getRequest()->getPost('buslineId');
            $busline=new admin_Model_Busline();
            $buslinedetails=$busline->find((integer)$BuslineId);
            $json=  admin_Model_Busline::getJson($buslinedetails);
       
            echo $json;exit;
        }
        
    }
    
    public function changestatusAction()
    {
        $this->_helper->viewRenderer->setNoRender(true);
         if ($this->_request->isPost()) {
             $BuslineId=$this->getRequest()->getPost('buslineId');
             $busline=new admin_Model_Busline();
             $buslinedetails=$busline->find((integer)$BuslineId);
             $enables=$buslinedetails->getenabled();
             $status=$busline->disablebusline((integer)$BuslineId,$enables);
             $result=  Zend_Json_Encoder::encode($status);
             echo $result;exit;
            
         }
        
    }
    
    public function deletebuslineAction ()
    {
         $this->_helper->viewRenderer->setNoRender(true);
          if ($this->_request->isPost()) {
              
               $BuslineId=$this->getRequest()->getPost('buslineId');
              
               $busline=new admin_Model_Busline();
               $busline->deleteBuslines((integer)$BuslineId);
               
          }
    }
    
   


}



